{"version":3,"file":"remote-entry.js","sources":["../../../node_modules/@sveltejs/kit/src/runtime/app/server/remote/shared.js","../../../node_modules/@sveltejs/kit/src/runtime/app/server/remote/command.js","../../../node_modules/@sveltejs/kit/src/runtime/app/server/remote/form.js","../../../node_modules/@sveltejs/kit/src/runtime/app/server/remote/prerender.js","../../../node_modules/@sveltejs/kit/src/runtime/app/server/remote/query.js"],"sourcesContent":["/** @import { RequestEvent } from '@sveltejs/kit' */\n/** @import { ServerHooks, MaybePromise, RequestState } from 'types' */\nimport { parse } from 'devalue';\nimport { error } from '@sveltejs/kit';\nimport { with_request_store, get_request_store } from '@sveltejs/kit/internal/server';\nimport { create_remote_cache_key, stringify_remote_arg } from '../../../shared.js';\n\n/**\n * @param {any} validate_or_fn\n * @param {(arg?: any) => any} [maybe_fn]\n * @returns {(arg?: any) => MaybePromise<any>}\n */\nexport function create_validator(validate_or_fn, maybe_fn) {\n\t// prevent functions without validators being called with arguments\n\tif (!maybe_fn) {\n\t\treturn (arg) => {\n\t\t\tif (arg !== undefined) {\n\t\t\t\terror(400, 'Bad Request');\n\t\t\t}\n\t\t};\n\t}\n\n\t// if 'unchecked', pass input through without validating\n\tif (validate_or_fn === 'unchecked') {\n\t\treturn (arg) => arg;\n\t}\n\n\t// use https://standardschema.dev validator if provided\n\tif ('~standard' in validate_or_fn) {\n\t\treturn async (arg) => {\n\t\t\t// Get event before async validation to ensure it's available in server environments without AsyncLocalStorage, too\n\t\t\tconst { event, state } = get_request_store();\n\t\t\tconst validate = validate_or_fn['~standard'].validate;\n\n\t\t\tconst result = await validate(arg);\n\n\t\t\t// if the `issues` field exists, the validation failed\n\t\t\tif (result.issues) {\n\t\t\t\terror(\n\t\t\t\t\t400,\n\t\t\t\t\tawait state.handleValidationError({\n\t\t\t\t\t\tissues: result.issues,\n\t\t\t\t\t\tevent\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn result.value;\n\t\t};\n\t}\n\n\tthrow new Error(\n\t\t'Invalid validator passed to remote function. Expected \"unchecked\" or a Standard Schema (https://standardschema.dev)'\n\t);\n}\n\n/**\n * In case of a single remote function call, just returns the result.\n *\n * In case of a full page reload, returns the response for a remote function call,\n * either from the cache or by invoking the function.\n * Also saves an uneval'ed version of the result for later HTML inlining for hydration.\n *\n * @template {MaybePromise<any>} T\n * @param {string} id\n * @param {any} arg\n * @param {RequestState} state\n * @param {() => Promise<T>} get_result\n * @returns {Promise<T>}\n */\nexport function get_response(id, arg, state, get_result) {\n\tconst cache_key = create_remote_cache_key(id, stringify_remote_arg(arg, state.transport));\n\n\treturn ((state.remote_data ??= {})[cache_key] ??= get_result());\n}\n\n/**\n * @param {any} data\n * @param {ServerHooks['transport']} transport\n */\nexport function parse_remote_response(data, transport) {\n\t/** @type {Record<string, any>} */\n\tconst revivers = {};\n\tfor (const key in transport) {\n\t\trevivers[key] = transport[key].decode;\n\t}\n\n\treturn parse(data, revivers);\n}\n\n/**\n * Like `with_event` but removes things from `event` you cannot see/call in remote functions, such as `setHeaders`.\n * @template T\n * @param {RequestEvent} event\n * @param {RequestState} state\n * @param {boolean} allow_cookies\n * @param {any} arg\n * @param {(arg: any) => any} validate\n * @param {(arg?: any) => T} fn\n */\nexport async function run_remote_function(event, state, allow_cookies, arg, validate, fn) {\n\t/** @type {RequestEvent} */\n\tconst cleansed = {\n\t\t...event,\n\t\tsetHeaders: () => {\n\t\t\tthrow new Error('setHeaders is not allowed in remote functions');\n\t\t},\n\t\tcookies: {\n\t\t\t...event.cookies,\n\t\t\tset: (name, value, opts) => {\n\t\t\t\tif (!allow_cookies) {\n\t\t\t\t\tthrow new Error('Cannot set cookies in `query` or `prerender` functions');\n\t\t\t\t}\n\n\t\t\t\tif (opts.path && !opts.path.startsWith('/')) {\n\t\t\t\t\tthrow new Error('Cookies set in remote functions must have an absolute path');\n\t\t\t\t}\n\n\t\t\t\treturn event.cookies.set(name, value, opts);\n\t\t\t},\n\t\t\tdelete: (name, opts) => {\n\t\t\t\tif (!allow_cookies) {\n\t\t\t\t\tthrow new Error('Cannot delete cookies in `query` or `prerender` functions');\n\t\t\t\t}\n\n\t\t\t\tif (opts.path && !opts.path.startsWith('/')) {\n\t\t\t\t\tthrow new Error('Cookies deleted in remote functions must have an absolute path');\n\t\t\t\t}\n\n\t\t\t\treturn event.cookies.delete(name, opts);\n\t\t\t}\n\t\t},\n\t\troute: { id: null },\n\t\turl: new URL(event.url.origin)\n\t};\n\n\t// In two parts, each with_event, so that runtimes without async local storage can still get the event at the start of the function\n\tconst validated = await with_request_store({ event: cleansed, state }, () => validate(arg));\n\treturn with_request_store({ event: cleansed, state }, () => fn(validated));\n}\n","/** @import { RemoteCommand } from '@sveltejs/kit' */\n/** @import { RemoteInfo, MaybePromise } from 'types' */\n/** @import { StandardSchemaV1 } from '@standard-schema/spec' */\nimport { get_request_store } from '@sveltejs/kit/internal/server';\nimport { create_validator, run_remote_function } from './shared.js';\n\n/**\n * Creates a remote command. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#command) for full documentation.\n *\n * @template Output\n * @overload\n * @param {() => Output} fn\n * @returns {RemoteCommand<void, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote command. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#command) for full documentation.\n *\n * @template Input\n * @template Output\n * @overload\n * @param {'unchecked'} validate\n * @param {(arg: Input) => Output} fn\n * @returns {RemoteCommand<Input, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote command. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#command) for full documentation.\n *\n * @template {StandardSchemaV1} Schema\n * @template Output\n * @overload\n * @param {Schema} validate\n * @param {(arg: StandardSchemaV1.InferOutput<Schema>) => Output} fn\n * @returns {RemoteCommand<StandardSchemaV1.InferInput<Schema>, Output>}\n * @since 2.27\n */\n/**\n * @template Input\n * @template Output\n * @param {any} validate_or_fn\n * @param {(arg?: Input) => Output} [maybe_fn]\n * @returns {RemoteCommand<Input, Output>}\n * @since 2.27\n */\n/*@__NO_SIDE_EFFECTS__*/\nexport function command(validate_or_fn, maybe_fn) {\n\t/** @type {(arg?: Input) => Output} */\n\tconst fn = maybe_fn ?? validate_or_fn;\n\n\t/** @type {(arg?: any) => MaybePromise<Input>} */\n\tconst validate = create_validator(validate_or_fn, maybe_fn);\n\n\t/** @type {RemoteInfo} */\n\tconst __ = { type: 'command', id: '', name: '' };\n\n\t/** @type {RemoteCommand<Input, Output> & { __: RemoteInfo }} */\n\tconst wrapper = (arg) => {\n\t\tconst { event, state } = get_request_store();\n\n\t\tif (!event.isRemoteRequest) {\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot call a command (\\`${__.name}(${maybe_fn ? '...' : ''})\\`) during server-side rendering`\n\t\t\t);\n\t\t}\n\n\t\tstate.refreshes ??= {};\n\n\t\tconst promise = Promise.resolve(run_remote_function(event, state, true, arg, validate, fn));\n\n\t\t// @ts-expect-error\n\t\tpromise.updates = () => {\n\t\t\tthrow new Error(`Cannot call '${__.name}(...).updates(...)' on the server`);\n\t\t};\n\n\t\treturn /** @type {ReturnType<RemoteCommand<Input, Output>>} */ (promise);\n\t};\n\n\tObject.defineProperty(wrapper, '__', { value: __ });\n\n\t// On the server, pending is always 0\n\tObject.defineProperty(wrapper, 'pending', {\n\t\tget: () => 0\n\t});\n\n\treturn wrapper;\n}\n","/** @import { RemoteForm } from '@sveltejs/kit' */\n/** @import { RemoteInfo, MaybePromise } from 'types' */\nimport { get_request_store } from '@sveltejs/kit/internal/server';\nimport { run_remote_function } from './shared.js';\n\n/**\n * Creates a form object that can be spread onto a `<form>` element.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#form) for full documentation.\n *\n * @template T\n * @param {(data: FormData) => MaybePromise<T>} fn\n * @returns {RemoteForm<T>}\n * @since 2.27\n */\n/*@__NO_SIDE_EFFECTS__*/\n// @ts-ignore we don't want to prefix `fn` with an underscore, as that will be user-visible\nexport function form(fn) {\n\t/**\n\t * @param {string | number | boolean} [key]\n\t */\n\tfunction create_instance(key) {\n\t\t/** @type {RemoteForm<T>} */\n\t\tconst instance = {};\n\n\t\tinstance.method = 'POST';\n\t\tinstance.onsubmit = () => {};\n\n\t\tObject.defineProperty(instance, 'enhance', {\n\t\t\tvalue: () => {\n\t\t\t\treturn { action: instance.action, method: instance.method, onsubmit: instance.onsubmit };\n\t\t\t}\n\t\t});\n\n\t\tconst button_props = {\n\t\t\ttype: 'submit',\n\t\t\tonclick: () => {}\n\t\t};\n\n\t\tObject.defineProperty(button_props, 'enhance', {\n\t\t\tvalue: () => {\n\t\t\t\treturn { type: 'submit', formaction: instance.buttonProps.formaction, onclick: () => {} };\n\t\t\t}\n\t\t});\n\n\t\tObject.defineProperty(instance, 'buttonProps', {\n\t\t\tvalue: button_props\n\t\t});\n\n\t\t/** @type {RemoteInfo} */\n\t\tconst __ = {\n\t\t\ttype: 'form',\n\t\t\tname: '',\n\t\t\tid: '',\n\t\t\t/** @param {FormData} form_data */\n\t\t\tfn: async (form_data) => {\n\t\t\t\tconst { event, state } = get_request_store();\n\n\t\t\t\tstate.refreshes ??= {};\n\n\t\t\t\tconst result = await run_remote_function(event, state, true, form_data, (d) => d, fn);\n\n\t\t\t\t// We don't need to care about args or deduplicating calls, because uneval results are only relevant in full page reloads\n\t\t\t\t// where only one form submission is active at the same time\n\t\t\t\tif (!event.isRemoteRequest) {\n\t\t\t\t\t(state.remote_data ??= {})[__.id] = result;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t};\n\n\t\tObject.defineProperty(instance, '__', { value: __ });\n\n\t\tObject.defineProperty(instance, 'action', {\n\t\t\tget: () => `?/remote=${__.id}`,\n\t\t\tenumerable: true\n\t\t});\n\n\t\tObject.defineProperty(button_props, 'formaction', {\n\t\t\tget: () => `?/remote=${__.id}`,\n\t\t\tenumerable: true\n\t\t});\n\n\t\tObject.defineProperty(instance, 'result', {\n\t\t\tget() {\n\t\t\t\ttry {\n\t\t\t\t\tconst { remote_data } = get_request_store().state;\n\t\t\t\t\treturn remote_data?.[__.id];\n\t\t\t\t} catch {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// On the server, pending is always 0\n\t\tObject.defineProperty(instance, 'pending', {\n\t\t\tget: () => 0\n\t\t});\n\n\t\t// On the server, buttonProps.pending is always 0\n\t\tObject.defineProperty(button_props, 'pending', {\n\t\t\tget: () => 0\n\t\t});\n\n\t\tif (key == undefined) {\n\t\t\tObject.defineProperty(instance, 'for', {\n\t\t\t\t/** @type {RemoteForm<any>['for']} */\n\t\t\t\tvalue: (key) => {\n\t\t\t\t\tconst { state } = get_request_store();\n\t\t\t\t\tlet instance = (state.form_instances ??= new Map()).get(key);\n\n\t\t\t\t\tif (!instance) {\n\t\t\t\t\t\tinstance = create_instance(key);\n\t\t\t\t\t\tinstance.__.id = `${__.id}/${encodeURIComponent(JSON.stringify(key))}`;\n\t\t\t\t\t\tinstance.__.name = __.name;\n\n\t\t\t\t\t\tstate.form_instances.set(key, instance);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn instance;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\treturn create_instance();\n}\n","/** @import { RemoteResource, RemotePrerenderFunction } from '@sveltejs/kit' */\n/** @import { RemotePrerenderInputsGenerator, RemoteInfo, MaybePromise } from 'types' */\n/** @import { StandardSchemaV1 } from '@standard-schema/spec' */\nimport { error, json } from '@sveltejs/kit';\nimport { DEV } from 'esm-env';\nimport { get_request_store } from '@sveltejs/kit/internal/server';\nimport { create_remote_cache_key, stringify, stringify_remote_arg } from '../../../shared.js';\nimport { app_dir, base } from '__sveltekit/paths';\nimport {\n\tcreate_validator,\n\tget_response,\n\tparse_remote_response,\n\trun_remote_function\n} from './shared.js';\n\n/**\n * Creates a remote prerender function. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#prerender) for full documentation.\n *\n * @template Output\n * @overload\n * @param {() => MaybePromise<Output>} fn\n * @param {{ inputs?: RemotePrerenderInputsGenerator<void>, dynamic?: boolean }} [options]\n * @returns {RemotePrerenderFunction<void, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote prerender function. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#prerender) for full documentation.\n *\n * @template Input\n * @template Output\n * @overload\n * @param {'unchecked'} validate\n * @param {(arg: Input) => MaybePromise<Output>} fn\n * @param {{ inputs?: RemotePrerenderInputsGenerator<Input>, dynamic?: boolean }} [options]\n * @returns {RemotePrerenderFunction<Input, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote prerender function. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#prerender) for full documentation.\n *\n * @template {StandardSchemaV1} Schema\n * @template Output\n * @overload\n * @param {Schema} schema\n * @param {(arg: StandardSchemaV1.InferOutput<Schema>) => MaybePromise<Output>} fn\n * @param {{ inputs?: RemotePrerenderInputsGenerator<StandardSchemaV1.InferInput<Schema>>, dynamic?: boolean }} [options]\n * @returns {RemotePrerenderFunction<StandardSchemaV1.InferInput<Schema>, Output>}\n * @since 2.27\n */\n/**\n * @template Input\n * @template Output\n * @param {any} validate_or_fn\n * @param {any} [fn_or_options]\n * @param {{ inputs?: RemotePrerenderInputsGenerator<Input>, dynamic?: boolean }} [maybe_options]\n * @returns {RemotePrerenderFunction<Input, Output>}\n * @since 2.27\n */\n/*@__NO_SIDE_EFFECTS__*/\nexport function prerender(validate_or_fn, fn_or_options, maybe_options) {\n\tconst maybe_fn = typeof fn_or_options === 'function' ? fn_or_options : undefined;\n\n\t/** @type {typeof maybe_options} */\n\tconst options = maybe_options ?? (maybe_fn ? undefined : fn_or_options);\n\n\t/** @type {(arg?: Input) => MaybePromise<Output>} */\n\tconst fn = maybe_fn ?? validate_or_fn;\n\n\t/** @type {(arg?: any) => MaybePromise<Input>} */\n\tconst validate = create_validator(validate_or_fn, maybe_fn);\n\n\t/** @type {RemoteInfo} */\n\tconst __ = {\n\t\ttype: 'prerender',\n\t\tid: '',\n\t\tname: '',\n\t\thas_arg: !!maybe_fn,\n\t\tinputs: options?.inputs,\n\t\tdynamic: options?.dynamic\n\t};\n\n\t/** @type {RemotePrerenderFunction<Input, Output> & { __: RemoteInfo }} */\n\tconst wrapper = (arg) => {\n\t\t/** @type {Promise<Output> & Partial<RemoteResource<Output>>} */\n\t\tconst promise = (async () => {\n\t\t\tconst { event, state } = get_request_store();\n\t\t\tconst payload = stringify_remote_arg(arg, state.transport);\n\t\t\tconst id = __.id;\n\t\t\tconst url = `${base}/${app_dir}/remote/${id}${payload ? `/${payload}` : ''}`;\n\n\t\t\tif (!state.prerendering && !DEV && !event.isRemoteRequest) {\n\t\t\t\ttry {\n\t\t\t\t\treturn await get_response(id, arg, state, async () => {\n\t\t\t\t\t\t// TODO adapters can provide prerendered data more efficiently than\n\t\t\t\t\t\t// fetching from the public internet\n\t\t\t\t\t\tconst response = await fetch(new URL(url, event.url.origin).href);\n\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tthrow new Error('Prerendered response not found');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst prerendered = await response.json();\n\n\t\t\t\t\t\tif (prerendered.type === 'error') {\n\t\t\t\t\t\t\terror(prerendered.status, prerendered.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// TODO can we redirect here?\n\n\t\t\t\t\t\t(state.remote_data ??= {})[create_remote_cache_key(id, payload)] = prerendered.result;\n\t\t\t\t\t\treturn parse_remote_response(prerendered.result, state.transport);\n\t\t\t\t\t});\n\t\t\t\t} catch {\n\t\t\t\t\t// not available prerendered, fallback to normal function\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.prerendering?.remote_responses.has(url)) {\n\t\t\t\treturn /** @type {Promise<any>} */ (state.prerendering.remote_responses.get(url));\n\t\t\t}\n\n\t\t\tconst promise = get_response(id, arg, state, () =>\n\t\t\t\trun_remote_function(event, state, false, arg, validate, fn)\n\t\t\t);\n\n\t\t\tif (state.prerendering) {\n\t\t\t\tstate.prerendering.remote_responses.set(url, promise);\n\t\t\t}\n\n\t\t\tconst result = await promise;\n\n\t\t\tif (state.prerendering) {\n\t\t\t\tconst body = { type: 'result', result: stringify(result, state.transport) };\n\t\t\t\tstate.prerendering.dependencies.set(url, {\n\t\t\t\t\tbody: JSON.stringify(body),\n\t\t\t\t\tresponse: json(body)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// TODO this is missing error/loading/current/status\n\t\t\treturn result;\n\t\t})();\n\n\t\tpromise.catch(() => {});\n\n\t\treturn /** @type {RemoteResource<Output>} */ (promise);\n\t};\n\n\tObject.defineProperty(wrapper, '__', { value: __ });\n\n\treturn wrapper;\n}\n","/** @import { RemoteQuery, RemoteQueryFunction } from '@sveltejs/kit' */\n/** @import { RemoteInfo, MaybePromise } from 'types' */\n/** @import { StandardSchemaV1 } from '@standard-schema/spec' */\nimport { get_request_store } from '@sveltejs/kit/internal/server';\nimport { create_remote_cache_key, stringify_remote_arg } from '../../../shared.js';\nimport { prerendering } from '__sveltekit/environment';\nimport { create_validator, get_response, run_remote_function } from './shared.js';\n\n/**\n * Creates a remote query. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#query) for full documentation.\n *\n * @template Output\n * @overload\n * @param {() => MaybePromise<Output>} fn\n * @returns {RemoteQueryFunction<void, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote query. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#query) for full documentation.\n *\n * @template Input\n * @template Output\n * @overload\n * @param {'unchecked'} validate\n * @param {(arg: Input) => MaybePromise<Output>} fn\n * @returns {RemoteQueryFunction<Input, Output>}\n * @since 2.27\n */\n/**\n * Creates a remote query. When called from the browser, the function will be invoked on the server via a `fetch` call.\n *\n * See [Remote functions](https://svelte.dev/docs/kit/remote-functions#query) for full documentation.\n *\n * @template {StandardSchemaV1} Schema\n * @template Output\n * @overload\n * @param {Schema} schema\n * @param {(arg: StandardSchemaV1.InferOutput<Schema>) => MaybePromise<Output>} fn\n * @returns {RemoteQueryFunction<StandardSchemaV1.InferInput<Schema>, Output>}\n * @since 2.27\n */\n/**\n * @template Input\n * @template Output\n * @param {any} validate_or_fn\n * @param {(args?: Input) => MaybePromise<Output>} [maybe_fn]\n * @returns {RemoteQueryFunction<Input, Output>}\n * @since 2.27\n */\n/*@__NO_SIDE_EFFECTS__*/\nexport function query(validate_or_fn, maybe_fn) {\n\t/** @type {(arg?: Input) => Output} */\n\tconst fn = maybe_fn ?? validate_or_fn;\n\n\t/** @type {(arg?: any) => MaybePromise<Input>} */\n\tconst validate = create_validator(validate_or_fn, maybe_fn);\n\n\t/** @type {RemoteInfo} */\n\tconst __ = { type: 'query', id: '', name: '' };\n\n\t/** @type {RemoteQueryFunction<Input, Output> & { __: RemoteInfo }} */\n\tconst wrapper = (arg) => {\n\t\tif (prerendering) {\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot call query '${__.name}' while prerendering, as prerendered pages need static data. Use 'prerender' from $app/server instead`\n\t\t\t);\n\t\t}\n\n\t\tconst { event, state } = get_request_store();\n\n\t\t/** @type {Promise<any> & Partial<RemoteQuery<any>>} */\n\t\tconst promise = get_response(__.id, arg, state, () =>\n\t\t\trun_remote_function(event, state, false, arg, validate, fn)\n\t\t);\n\n\t\tpromise.catch(() => {});\n\n\t\tpromise.refresh = async () => {\n\t\t\tconst { state } = get_request_store();\n\t\t\tconst refreshes = state.refreshes;\n\n\t\t\tif (!refreshes) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Cannot call refresh on query '${__.name}' because it is not executed in the context of a command/form remote function`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst cache_key = create_remote_cache_key(__.id, stringify_remote_arg(arg, state.transport));\n\t\t\trefreshes[cache_key] = await /** @type {Promise<any>} */ (promise);\n\t\t};\n\n\t\tpromise.withOverride = () => {\n\t\t\tthrow new Error(`Cannot call '${__.name}.withOverride()' on the server`);\n\t\t};\n\n\t\treturn /** @type {RemoteQuery<Output>} */ (promise);\n\t};\n\n\tObject.defineProperty(wrapper, '__', { value: __ });\n\n\treturn wrapper;\n}\n"],"names":["key","instance","promise","state"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}